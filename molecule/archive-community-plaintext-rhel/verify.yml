---
### Validates that Confluent CLI is installed.

- name: Verify - Confluent CLI
  hosts: all
  gather_facts: false
  tasks:
    - name: Check confluent cli is installed
      command: "/usr/local/bin/confluent version"

- name: Verify - kafka_controller
  hosts: kafka_controller
  gather_facts: false
  tasks:
    - name: Check process role
      import_role:
        name: confluent.test
        tasks_from: check_property.yml
      vars:
        file_path: /etc/kafka/server.properties
        property: process.roles
        expected_value: controller

    - name: Check listener
      import_role:
        name: confluent.test
        tasks_from: check_property.yml
      vars:
        file_path: /etc/kafka/server.properties
        property: listeners
        expected_value: CONTROLLER://:9093

    - name: Check quorum voters
      import_role:
        name: confluent.test
        tasks_from: check_property.yml
      vars:
        file_path: /etc/kafka/server.properties
        property: controller.quorum.voters
        expected_value: 9991@controller1:9093,9992@controller2:9093,9993@controller3:9093

- name: Verify - kafka_broker
  hosts: kafka_broker
  gather_facts: false
  tasks:
    - name: Check process role
      import_role:
        name: confluent.test
        tasks_from: check_property.yml
      vars:
        file_path: /etc/kafka/server.properties
        property: process.roles
        expected_value: broker
      when: kraft_enabled|bool
